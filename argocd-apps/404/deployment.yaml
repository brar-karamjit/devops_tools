# File: devops_tools/argocd-apps/404/deployment.yaml
# Custom 404 error page — default backend for nginx-ingress
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-error-pages
  namespace: "404"
data:
  "404.html": |
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>404 — Lost in the Cluster</title>
      <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}
        .scene{text-align:center;padding:2rem;position:relative;z-index:1}
        .code{font-size:8rem;font-weight:800;background:linear-gradient(135deg,#f43f5e,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;margin-bottom:.5rem;animation:float 3s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
        h1{font-size:1.5rem;color:#94a3b8;margin-bottom:1rem;font-weight:500}
        p{color:#64748b;max-width:420px;margin:0 auto 2rem;line-height:1.6}
        .home-btn{display:inline-block;padding:.75rem 2rem;background:linear-gradient(135deg,#38bdf8,#818cf8);color:#0f172a;text-decoration:none;border-radius:10px;font-weight:600;font-size:1rem;transition:transform .2s,box-shadow .2s}
        .home-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(56,189,248,.3)}
        .stars{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
        .star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle var(--d) ease-in-out infinite}
        @keyframes twinkle{0%,100%{opacity:.2}50%{opacity:.8}}
        .kubectl{margin-top:2rem;background:#1e293b;border:1px solid #334155;border-radius:8px;padding:1rem 1.5rem;display:inline-block;font-family:'Courier New',monospace;font-size:.85rem;color:#64748b}
        .kubectl span{color:#38bdf8}
      </style>
    </head>
    <body>
      <div class="stars" id="stars"></div>
      <div class="scene">
        <div class="code">404</div>
        <h1>Lost in the Cluster</h1>
        <p>The resource you're looking for doesn't exist in this namespace.
           Maybe it was evicted, or perhaps it never existed at all.</p>
        <a href="/" class="home-btn">Return to Base</a>
        <div class="kubectl">
          <span>$</span> kubectl get page — <em>Error: not found</em>
        </div>
      </div>
      <script>
        const c=document.getElementById('stars');
        for(let i=0;i<80;i++){const s=document.createElement('div');s.className='star';s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%';s.style.setProperty('--d',(2+Math.random()*3)+'s');s.style.animationDelay=Math.random()*3+'s';c.appendChild(s)}
      </script>
    </body>
    </html>
  nginx.conf: |
    worker_processes 1;
    events { worker_connections 64; }
    http {
      server {
        listen 8080;
        location / {
          root /usr/share/nginx/html;
          try_files /404.html =404;
          default_type text/html;
        }
        location /healthz {
          return 200 'ok';
          add_header Content-Type text/plain;
        }
      }
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: custom-error-backend
  namespace: "404"
  labels:
    app: custom-error-backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: custom-error-backend
  template:
    metadata:
      labels:
        app: custom-error-backend
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: error-pages
          mountPath: /usr/share/nginx/html/404.html
          subPath: "404.html"
          readOnly: true
        - name: error-pages
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
          readOnly: true
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 3
          periodSeconds: 5
      volumes:
      - name: error-pages
        configMap:
          name: custom-error-pages
---
apiVersion: v1
kind: Service
metadata:
  name: custom-error-backend
  namespace: "404"
spec:
  selector:
    app: custom-error-backend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
