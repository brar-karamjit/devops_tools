# Recommended Refinements for OCI ARM + NGINX
global:
  # Ensures Argo components pull the correct arm64 images and land on your ARM nodes
  nodeSelector:
    kubernetes.io/arch: arm64

server:
  service:
    type: ClusterIP

  ingress:
    enabled: true
    ingressClassName: nginx 
    hostname: argocd.karamjitbrar.com
    path: /
    pathType: Prefix
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    tls:
      - hosts:
          - argocd.karamjitbrar.com
        secretName: argocd-tls

  # Essential: If NGINX is doing the TLS termination (which it is via cert-manager),
  # the Argo server itself needs to run in insecure mode to avoid a redirect loop.
  extraArgs:
    - --insecure

configs:
  cm:
    admin.enabled: true
    timeout.reconciliation: 15s
    url: https://argocd.karamjitbrar.com
  
  params:
    server.insecure: true # Matches the extraArgs above

# Explicitly ensure ApplicationSet controller is enabled (it is by default in newer charts, 
# but good to have in the file for ARM node affinity)
applicationSet:
  enabled: true
  nodeSelector:
    kubernetes.io/arch: arm64